<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>UST colour game</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Audio Elements -->
    <audio id="backgroundMusic" loop preload="auto">
        <!-- Free Creative Commons music - replace with your own files -->
        <source src="https://archive.org/download/DST-DarknessToLight/DST-DarknessToLight.mp3" type="audio/mpeg">
        <!-- Fallback: You can replace with your own music files -->
    </audio>
    
    <audio id="correctSound" preload="auto">
        <!-- Simple correct sound - will use Web Audio API fallback -->
    </audio>
    
    <audio id="wrongSound" preload="auto">
        <!-- Simple wrong sound - will use Web Audio API fallback -->
    </audio>

    <div class="game-container">
        <!-- Game Header -->
        <header class="game-header">
            <div class="logo">
                <img src="ust_logo.jpg" alt="UST Logo" class="ust-logo">
                <h1>UST COLOUR QUIZ GAME</h1>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">ustar Points</span>
                    <span class="stat-value" id="score">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Lives</span>
                    <span class="stat-value" id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Level</span>
                    <span class="stat-value" id="level">1</span>
                </div>
                <div class="stat-item">
                    <button id="audioToggle" class="audio-toggle" title="Toggle Background Music">
                        üîä
                    </button>
                </div>
            </div>
        </header>

        <!-- Game Main Area -->
        <main class="game-main">
            <!-- High Score Table Sidebar -->
            <aside class="high-score-sidebar">
                <div class="current-player" id="currentPlayer">
                    <div class="player-info">
                        <div class="player-avatar">üë§</div>
                        <div class="player-details">
                            <div class="player-name" id="currentPlayerName">Player</div>
                            <div class="player-account" id="currentPlayerAccount">Guest</div>
                            <div class="current-score">Score: <span id="currentPlayerScore">0</span></div>
                        </div>
                    </div>
                </div>
                
                <!-- UST Color Categories Reference -->
                <div class="color-reference">
                    <h4>Color Categories</h4>
                    <div class="color-categories-compact">
                        <div class="color-item" data-color="Purple">
                            <div class="color-dot" style="background-color: #7B2CBF;"></div>
                            <span>Purple</span>
                        </div>
                        <div class="color-item" data-color="Indigo">
                            <div class="color-dot" style="background-color: #3F37C9;"></div>
                            <span>Indigo </span>
                        </div>
                        <div class="color-item" data-color="Quartz">
                            <div class="color-dot" style="background-color: #51484F;"></div>
                            <span>Quartz </span>
                        </div>
                        <div class="color-item" data-color="Green">
                            <div class="color-dot" style="background-color: #01B27C;"></div>
                            <span>Green</span>
                        </div>
                        <div class="color-item" data-color="Gold">
                            <div class="color-dot" style="background-color: #FFD700;"></div>
                            <span>Gold </span>
                        </div>
                        <div class="color-item" data-color="Orange">
                            <div class="color-dot" style="background-color: #FF8500;"></div>
                            <span>Orange </span>
                        </div>
                        <div class="color-item" data-color="Rose">
                            <div class="color-dot" style="background-color: #FF69B4;"></div>
                            <span>Rose </span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Game Content Area -->
            <div class="game-content">
                <!-- Current Question Display -->
                <div class="question-display" id="questionDisplay">
                    <h2 class="current-question" id="currentQuestion">Get ready to start the quiz!</h2>
                </div>
                
                <!-- Game Canvas -->
                <div class="game-area">
                    <canvas id="gameCanvas"></canvas>
                
                <!-- Game Overlays -->
                <!-- Player Registration Screen -->
                <div class="game-overlay" id="playerRegistrationScreen">
                    <div class="overlay-content registration-content">
                        <h2>üéÆ Welcome to UST Color Quiz! üåà</h2>
                        <div class="registration-form">
                            <div class="form-group">
                                <label for="playerName">üë§ Player Name:</label>
                                <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
                            </div>
                            <div class="form-group">
                                <label for="playerAccount">üè¢ Account Name(Optional):</label>
                                <input type="text" id="playerAccount" placeholder="Enter your UST ID" maxlength="50">
                            </div>
                        </div>
                        <button class="start-btn" onclick="startGameDirectly()">START GAME üöÄ</button>
                    </div>
                </div>

                <div class="game-overlay hidden" id="startScreen">
                    <div class="overlay-content">
                        <h2>üåà Find UST Colours! ‚úàÔ∏è</h2>
                        <p>Pilot your aircraft to collect the correct colors:</p>
                        <div class="gesture-instructions">
                            <div class="gesture-item">
                                <span class="gesture-icon">‚úã</span>
                                <span>Open Hand = Fly Up</span>
                            </div>
                            <div class="gesture-item">
                                <span class="gesture-icon">‚úä</span>
                                <span>Closed Fist = Fly Down</span>
                            </div>
                        </div>
                        <div class="color-info">
                            <p><strong>How to Play:</strong></p>
                            <p>‚Ä¢ Read the question at the top of the screen</p>
                            <p>‚Ä¢ Flying color blocks will appear from the right</p>
                            <p>‚Ä¢ Use gestures to fly and collect the CORRECT color</p>
                            <p>‚Ä¢ Earn 100 ustar points for each correct collection</p>
                            <p>‚Ä¢ You have 4 lives - avoid wrong colors!</p>
                        </div>
                        <button class="start-btn" onclick="startGame()">START QUIZ</button>
                        </div>
                </div>

                <div class="game-overlay hidden" id="pauseScreen">
                    <div class="overlay-content">
                        <h2>‚è∏Ô∏è Quiz Paused</h2>
                        <button class="resume-btn" onclick="resumeGame()">RESUME QUIZ</button>
                        <button class="restart-btn" onclick="restartGame()">RESTART QUIZ</button>
                    </div>
                </div>

                <div class="game-overlay hidden" id="gameOverScreen">
                    <div class="overlay-content">
                        <h2>üéØ Quiz Complete!</h2>
                        <p class="final-score">Final Score: <span id="finalScore">0</span></p>
                        <div class="achievements" id="achievements"></div>
                        <button class="restart-btn" onclick="restartGame()">TRY AGAIN</button>
                    </div>
                </div>

                <div class="game-overlay hidden" id="winnerScreen">
                    <div class="overlay-content winner-content">
                        <h2>üèÜ CONGRATULATIONS! üåà</h2>
                        <h3>üéâ You answered all 7 color categories correctly!üéâ</h3>
                        <button class="restart-btn winner-btn" onclick="restartGame()">üöÄ NEW MISSION</button>
                    </div>
                </div>

                <!-- Hand Tracking Video -->
                <video id="videoElement" class="hand-tracking-video" autoplay muted playsinline></video>
                <canvas id="handCanvas" class="hand-tracking-overlay"></canvas>
            </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <div class="gesture-status">
                    <h3>ü§ñ Gesture Recognition</h3>
                    <div class="status-indicator" id="cameraStatus">
                        <span class="status-light"></span>
                        <span>Camera: Connecting...</span>
                    </div>
                    <div class="current-gesture">
                        <span class="gesture-display" id="currentGesture">ü§∑‚Äç‚ôÇÔ∏è No Gesture</span>
                    </div>
                    <div class="gesture-confidence">
                        <label>Confidence:</label>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceBar"></div>
                        </div>
                        <span id="confidenceText">0%</span>
                    </div>
                </div>

                <div class="performance-stats">
                    <h3>üìä Quiz Statistics</h3>
                    <div class="stat-row">
                        <span>Accuracy:</span>
                        <span id="accuracy">0%</span>
                    </div>
                    <div class="stat-row">
                        <span>Correct Answers:</span>
                        <span id="enemiesHit">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Questions Answered:</span>
                        <span id="timePlayed">0 Questions</span>
                    </div>
                </div>
                <h3 style="color: #51484F;font-family: Arial;">üèÜ High Scores</h3>
                <div class="score-list" id="scoreList">
                    <div class="no-scores-message" id="noScoresMessage">
                        <p style="color: #ffffff; text-align: center; padding: 20px; font-style: italic;">
                            üéÆ No high scores yet!<br>
                            Be the first to complete the quiz!
                        </p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scroll Indicator -->
    <div class="scroll-indicator" id="scrollIndicator">
        ‚Üì
    </div>

    <!-- MediaPipe Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    
    <!-- Game Scripts -->
    <script>
        // Clear existing demo data from localStorage (one-time cleanup)
        if (localStorage.getItem('ustColorGameHighScores')) {
            const scores = JSON.parse(localStorage.getItem('ustColorGameHighScores'));
            const hasDemoData = scores.some(score => 
                score.name === 'Demo Player' || 
                score.name === 'Test User' || 
                score.name === 'Quiz Master' ||
                score.account === 'demo@ust.hk' ||
                score.account === 'test@ust.hk'
            );
            if (hasDemoData) {
                localStorage.removeItem('ustColorGameHighScores');
                console.log('Demo data cleared from localStorage');
            }
        }
    </script>
    <script src="scrollManager.js"></script>
    <script src="audioManager.js"></script>
    <script src="highScoreManager.js"></script>
    <script src="playerRegistration.js"></script>
    <script src="touchControls.js"></script>
    <script src="game.js"></script>
    <script src="handTracking.js"></script>
    <script src="app.js"></script>
</body>
</html>
